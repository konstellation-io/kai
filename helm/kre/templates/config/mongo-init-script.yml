apiVersion: v1
kind: ConfigMap
metadata:
  name: kre-mongo-init-script
  labels:
    {{- include "kre.labels" . | nindent 4 }}

data:
  init-admin.js: |
    conn = new Mongo();
    db = conn.getDB("{{ .Values.mongodb.mongodbDatabase }}");
    db.auth( "{{ .Values.mongodb.mongodbUsername }}", "{{ .Values.mongodb.mongodbPassword }}" );

    db.getCollection('users').insert({
      "_id": "kre_admin_user",
      "email": "{{ .Values.config.admin.userEmail }}",
      "deleted": false,
      "accessLevel": "ADMIN",
      "creationDate": ISODate("2000-01-01T00:00:00.001Z")
    })
